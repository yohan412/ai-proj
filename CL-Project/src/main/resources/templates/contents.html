<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>영상 편집 툴</title>
  <link rel="stylesheet" href="/css/main.css" />
  <link rel="stylesheet" href="/css/login.css" />
  <noscript><link rel="stylesheet" href="/css/noscript.css" /></noscript>

  <style>
    :root{
      --bg: #2e3842;
      --panel:#242c35;
      --panel-2:#1f252c;
      --line:#3c4550;
      --text:#e7f1ff;
      --muted:#9fb3c8;
      --accent:#1f90ff;
    }

    body{ margin:0; background:var(--bg); color:#fff; font-family:Arial, Helvetica, sans-serif; }

    /* ===== 2열 레이아웃 ===== */
    .editor-container{
      height:100vh; padding:24px; box-sizing:border-box;
      display:flex; justify-content:center; align-items:center;
    }
    .editor-shell{
      width:100%; max-width:1400px; height:92vh;
      display:grid; gap:16px;
      grid-template-columns: minmax(700px,1fr) 560px; /* 오른쪽 패널 넓게 */
    }

    /* ===== 왼쪽 편집기 ===== */
    .editor-inner{
      display:flex; flex-direction:column; height:100%;
      background:var(--panel-2); border:1px solid var(--line); border-radius:8px;
      overflow:hidden; box-shadow:0 0 10px rgba(0,0,0,.3);
    }
    .preview-area{
      flex:1; position:relative; display:flex; align-items:center; justify-content:center;
      background:var(--panel-2); cursor:pointer;
    }
    .preview-area.dragover{ outline:2px dashed var(--accent); }
    .preview-area video, .preview-area img{
      max-height:100%; max-width:100%; border-radius:8px;
      box-shadow:0 4px 20px rgba(0,0,0,.5);
    }
    #video-input{ display:none; }

    /* ===== 타임라인 ===== */
    .timeline-container{ position:relative; background:var(--panel); padding:40px 20px 20px; border-top:1px solid var(--line); }
    .timeline-container .segment-bar{
      position:absolute; top:10px; left:20px; right:20px; height:6px;
      background:rgba(255,255,255,.3); border-radius:3px; z-index:2; cursor:pointer;
    }
    .timeline-container .segment-bar .handle{
      position:absolute; top:-4px; width:12px; height:14px;
      background:rgba(255,255,255,.85); border-radius:3px; cursor:ew-resize; z-index:3;
    }
    .timeline-container .segment-bar .handle.start{ left:0; }
    .timeline-container .time-label{
      position:absolute; top:24px; left:20px; font-size:12px; color:rgba(255,255,255,.85); z-index:2;
    }
    .timeline{ display:flex; align-items:center; margin-top:25px; }
    .timeline-item{
      flex:0 0 auto; width:100px; height:100px; background:#3d4754;
      margin-right:10px; border-radius:6px; transition:transform .2s;
    }
    .timeline-item:hover{ transform:scale(1.05); background:#505c6a; }

    /* ===== 오른쪽 패널 ===== */
    .right-panel{
      background:var(--panel); border:1px solid var(--line); border-radius:8px;
      box-shadow:0 0 10px rgba(0,0,0,.3); display:flex; flex-direction:column;
      min-width:560px; overflow:auto;
    }
    .right-panel .panel-header{
      padding:10px 12px; border-bottom:1px solid var(--line);
      font-size:12px; letter-spacing:2px; color:var(--muted);
      display:flex; align-items:center; justify-content:space-between;
    }

    /* 오른쪽 텍스트 미리보기(좌측 정렬) */
    .vtext-preview{
      flex:1; margin:12px; min-height:120px; background:var(--panel-2);
      border:1px dashed var(--line); border-radius:6px;
      display:flex; align-items:flex-start; justify-content:flex-start;
      overflow:auto; padding:10px 12px;
    }
    .vtext-list{
      display:flex; flex-direction:column; align-items:flex-start;
      gap:6px; width:100%;
    }
    .vtext-line{
      white-space:pre-wrap; word-break:break-word;
      line-height:1.25; color:#fff; text-align:left;
    }

    /* 반응형 */
    @media (max-width: 1100px){
      .editor-shell{ grid-template-columns: 1fr; height:auto; }
      .right-panel{ min-width:0; }
    }
  </style>
</head>
<body>
  <div th:replace="~{fragments/header :: header}"></div>

  <input type="file" id="video-input" accept="video/*">

  <div class="editor-container">
    <div class="editor-shell">

      <!-- ===== 왼쪽: 편집기 ===== -->
      <div class="editor-inner">
        <div class="preview-area" id="preview-area">
          <img id="preview-media" alt="video preview"
               src="https://via.placeholder.com/360x640/000000/FFFFFF?text=PREVIEW"/>
        </div>

        <div class="timeline-container" id="timeline-container">
          <div class="segment-bar" id="segment-bar">
            <div class="handle start" id="start-handle"></div>
          </div>
          <span class="time-label" id="time-label">0:00 - 0:00</span>
          <div class="timeline" id="timeline">
            <div class="timeline-item"></div>
          </div>
        </div>
      </div>

      <!-- ===== 오른쪽: 텍스트 미리보기만 표시 ===== -->
      <aside class="right-panel">
        <div class="panel-header">
          <span>TEXT</span>
        </div>

        <div class="vtext-preview">
          <div id="vtext-list" class="vtext-list">
            <!-- 필요 시 아래 예시 텍스트를 수정해 사용 -->
            <div class="vtext-line">첫 줄 텍스트</div>
            <div class="vtext-line">둘째 줄 텍스트</div>
            <div class="vtext-line">셋째 줄 텍스트</div>
          </div>
        </div>
      </aside>
    </div>
  </div>

  <script src="/js/jquery.min.js"></script>
  <script>
    /* ===== 기본 참조 ===== */
    const input = document.getElementById('video-input');
    const previewArea = document.getElementById('preview-area');
    const segmentBar = document.getElementById('segment-bar');
    const handle = document.getElementById('start-handle');
    const timeLabel = document.getElementById('time-label');

    let videoEl, duration = 0;

    /* ===== 파일 선택/드래그 ===== */
    previewArea.addEventListener('click', (e)=>{
      if(e.target.tagName.toLowerCase()==='video') return;
      input.click();
    });
    previewArea.addEventListener('dragover', e=>{ e.preventDefault(); previewArea.classList.add('dragover'); });
    previewArea.addEventListener('dragleave', ()=> previewArea.classList.remove('dragover'));
    previewArea.addEventListener('drop', e=>{
      e.preventDefault(); previewArea.classList.remove('dragover');
      const file = e.dataTransfer.files?.[0];
      if(file && file.type.startsWith('video/')) loadVideo(file);
    });
    input.addEventListener('change', e=>{
      const file = e.target.files?.[0];
      if(file && file.type.startsWith('video/')) loadVideo(file);
    });

    function loadVideo(file){
      const url = URL.createObjectURL(file);
      previewArea.innerHTML = '';
      videoEl = document.createElement('video');
      videoEl.src = url;
      videoEl.controls = true;
      videoEl.style.maxHeight = '100%';
      videoEl.style.maxWidth = '100%';
      videoEl.style.borderRadius = '8px';
      previewArea.appendChild(videoEl);

      duration = 0;
      videoEl.addEventListener('loadedmetadata', ()=>{
        duration = videoEl.duration || 0;
        initSegmentControls();
      });
    }

    function initSegmentControls(){
      handle.style.left = '0px';
      updateTimeLabel(0, duration);
      bindSegmentEvents();
    }

    function bindSegmentEvents(){
      segmentBar.addEventListener('click', e=>{
        const rect = segmentBar.getBoundingClientRect();
        const offset = Math.min(Math.max(0, e.clientX - rect.left), rect.width);
        const t = duration * (offset / rect.width);
        if(videoEl) videoEl.currentTime = t;
        handle.style.left = offset + 'px';
        updateTimeLabel(t, duration);
      });

      let startX, startLeft;
      handle.addEventListener('mousedown', e=>{
        e.stopPropagation(); e.preventDefault();
        startX = e.clientX; startLeft = handle.offsetLeft;
        document.documentElement.addEventListener('mousemove', doDrag);
        document.documentElement.addEventListener('mouseup', stopDrag);
      });
      function doDrag(e){
        const rect = segmentBar.getBoundingClientRect();
        let delta = e.clientX - startX;
        let newLeft = Math.min(Math.max(0, startLeft + delta), rect.width);
        handle.style.left = newLeft + 'px';
        const t = duration * (newLeft / rect.width);
        if(videoEl) videoEl.currentTime = t;
        updateTimeLabel(t, duration);
      }
      function stopDrag(){
        document.documentElement.removeEventListener('mousemove', doDrag);
        document.documentElement.removeEventListener('mouseup', stopDrag);
      }
    }

    function updateTimeLabel(start, end){
      const fmt = t => { const m = Math.floor(t/60); const s = Math.floor(t%60).toString().padStart(2,'0'); return `${m}:${s}`; };
      timeLabel.textContent = `${fmt(start)} - ${fmt(end)}`;
    }
  </script>

  <!-- 기타 스크립트(선택) -->
  <script src="/js/jquery.scrollex.min.js"></script>
  <script src="/js/jquery.scrolly.min.js"></script>
  <script src="/js/browser.min.js"></script>
  <script src="/js/breakpoints.min.js"></script>
  <script src="/js/util.js"></script>
  <script src="/js/main.js"></script>
</body>
</html>
