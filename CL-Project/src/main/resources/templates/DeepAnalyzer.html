<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
  <head>
    <meta charset="UTF-8">
    <title>Deep Analyzer</title>
	
	<!--icon-->
	<link rel="icon" href="/images/profile/favicon.png" type="image/x-icon">
    
    <!-- Stylesheets -->
    <link rel="stylesheet" href="/css/sidebar.css">
    <link rel="stylesheet" href="/css/topbar.css">
    <link rel="stylesheet" href="/css/loginModal.css">
    <link rel="stylesheet" href="/css/DeepAnalyzer.css">
    <link rel="stylesheet" href="/css/custom-video-player-component.css">

    <!-- Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Shared Scripts (Order is important) -->
    <script src="/js/session.js"></script>
    <script src="/js/auth-fetch.js"></script>
    <script src="/js/sidebar.js"></script>
    <script src="/js/topbar.js"></script>
    <script src="/js/loginModal.js"></script>
    <script src="/js/AnalyzerShare.js"></script>
    <script src="/js/DeepAnalyzer.js"></script>

    <!-- Client-side auth guard -->
    <script>
        if (!isLoggedIn()) {
            window.location.href = '/';
        }
    </script>
</head>
  <body>
  <!-- Sidebar toggle button (hamburger icon) -->
  <div class="sidebar-toggle" onclick="toggleSidebar()">☰</div>

  <!-- Topbar fragment: login/profile/logout UI -->
  <div th:replace="~{fragments/topbar :: topbar}"></div>

  <!-- Login Modal fragment: login form dialog -->
  <div th:replace="~{fragments/loginModal :: loginModal}"></div>

  <!-- Left Sidebar fragment: navigation menu -->
  <div th:replace="~{fragments/sidebar :: sidebar}"></div> 

  <!-- ▣ main grid -->
  <div class="container" id="mainContainer">
    
    <div class="cell video-section" id="videoDrop">
      <p id="uploadHint">Drag & Drop your video here or click to select</p>
      <input type="file" id="videoInput" accept="video/*" style="display: none" />
      
      <!-- Wrapper for video content -->
      <div class="video-scale-wrapper">
        <div class="video-content-wrapper" style="display: none;">
          <div th:replace="~{fragments/customVideoPlayer :: videoPlayer(playerId='originalVideoPlayer')}"></div>
            <div class="editor-controls">
              <div id="editButtons" style="display: none">
                <button id="startEditBtn">Start Edit</button>
                <button id="endEditBtn">End Edit</button>
              </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ② original graph -->
    <div class="cell graph-box">
        <h3 class="graph-title">Original&nbsp;CL&nbsp;Graph</h3>
        <div class="cognitive-load-controls">
            <button id="showCumulativeBtnOriginal">Show&nbsp;Cumulative</button>
            <button id="showInstantaneousBtnOriginal">Show&nbsp;Instantaneous</button>
        </div>
        <div class="graph-canvas-wrapper graph-container">
            <canvas id="dualGraphCanvasOriginal"></canvas>
            <div class="graph-loading-overlay">
                <div class="loader"></div>
            </div>
        </div>
        
    </div>

    <!-- ③ edited previews + player + pager + × -->
    <div class="cell video-box edited" id="editedSection">
      <div class="edited-scale-wrapper">
        <div class="preview-grid" id="previewGrid">
          <!-- square thumbnails (duplicates for demo) -->
        </div>
        <div class="pager" id="pager">
          <button class="pager-btn" aria-label="Previous">&#10094;</button>
          <div class="pager-dots">
            <span class="dot active"></span><span class="dot"></span><span class="dot"></span>
          </div>
          <button class="pager-btn" aria-label="Next">&#10095;</button>
        </div>
      </div>
      <div class="edited-player-container" id="editedPlayerContainer" style="display: none;">
        <div th:replace="~{fragments/customVideoPlayer :: videoPlayer(playerId='editedVideoPlayer')}"></div>
        <button id="closePlayer" class="close-btn" aria-label="Close">&times;</button>
      </div>
    </div>
    
    <!-- ④ edited graph -->
    <div class="cell graph-box">
        <h3 class="graph-title">Edited&nbsp;CL&nbsp;Graph</h3>
        <div class="cognitive-load-controls">
            <button id="showCumulativeBtnEdited">Show&nbsp;Cumulative</button>
            <button id="showInstantaneousBtnEdited">Show&nbsp;Instantaneous</button>
        </div>
        <div class="graph-canvas-wrapper graph-container">
            <canvas id="dualGraphCanvasEdited"></canvas>
            <div class="graph-loading-overlay">
                <div class="loader"></div>
            </div>
        </div>
        
    </div>
    </div>
  <!-- /container -->
  </body>
</html>