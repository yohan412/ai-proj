<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>영상 편집 툴</title>
  <link rel="stylesheet" href="/css/main.css" />
  <link rel="stylesheet" href="/css/login.css" />
  <noscript><link rel="stylesheet" href="/css/noscript.css" /></noscript>
  <style>
    body { margin: 0; background-color: #2e3842; font-family: 'Arial', sans-serif; color: #fff; }
    .editor-container { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; }
    .editor-inner { width: 100%; max-width: 1200px; display: flex; flex-direction: column; height: 90vh; border: 1px solid #3c4550; border-radius: 8px; overflow: hidden; box-shadow: 0 0 10px rgba(0,0,0,0.3); }
    .preview-area { flex: 1; position: relative; display: flex; align-items: center; justify-content: center; background-color: #1f252c; cursor: pointer; }
    .preview-area.dragover { outline: 2px dashed #1f90ff; }
    .preview-area video, .preview-area img { max-height: 100%; max-width: 100%; border-radius: 8px; box-shadow: 0 4px 20px rgba(0,0,0,0.5); }
    #video-input { display:none; }
    /* 타임라인 컨테이너 */
    .timeline-container { position: relative; background-color: #242c35; padding: 40px 20px 20px; border-top: 1px solid #3c4550; overflow-x: auto; }
    .timeline-container .segment-bar { position: absolute; top: 10px; left: 20px; right: 20px; height: 6px; background: rgba(255,255,255,0.3); border-radius: 3px; z-index: 2; cursor: pointer; }
    .timeline-container .segment-bar .handle { position: absolute; top: -4px; width: 12px; height: 14px; background: rgba(255,255,255,0.8); border-radius: 3px; cursor: ew-resize; z-index: 3; }
    .timeline-container .segment-bar .handle.start { left: 0; }
    .timeline-container .time-label { position: absolute; top: 24px; left: 20px; font-size: 12px; color: rgba(255,255,255,0.8); z-index: 2; }
    .timeline {
      display: flex;
      align-items: center;
      margin-top: 25px;
    }
    .timeline-item { flex: 0 0 auto; width: 100px; height: 100px; background-color: #3d4754; margin-right: 10px; border-radius: 6px; transition: transform 0.2s; }
    .timeline-item:hover { transform: scale(1.05); background-color: #505c6a; }
  </style>
</head>
<body>
  <div th:replace="~{fragments/header :: header}"></div>
  <input type="file" id="video-input" accept="video/*">
  <div class="editor-container">
    <div class="editor-inner">
      <div class="preview-area" id="preview-area">
        <img src="https://via.placeholder.com/360x640/000000/FFFFFF?text=PREVIEW" alt="video preview" id="preview-media">
      </div>
      <div class="timeline-container" id="timeline-container">
        <div class="segment-bar" id="segment-bar">
          <div class="handle start" id="start-handle"></div>
        </div>
        <span class="time-label" id="time-label">0:00 - 0:00</span>
        <div class="timeline" id="timeline">
          <div class="timeline-item"></div>
        </div>
      </div>
    </div>
  </div>
  <script src="/js/jquery.min.js"></script>
  <script>
    const input = document.getElementById('video-input');
    const previewArea = document.getElementById('preview-area');
    const timelineContainer = document.getElementById('timeline-container');
    const segmentBar = document.getElementById('segment-bar');
    const handle = document.getElementById('start-handle');
    const timeLabel = document.getElementById('time-label');
    let videoEl, duration = 0;

    previewArea.addEventListener('click', (e) => {
        // 비디오 요소 클릭 시 이벤트 무시
        if (e.target.tagName.toLowerCase() === 'video') return;
        input.click();
      });
    previewArea.addEventListener('dragover', e => { e.preventDefault(); previewArea.classList.add('dragover'); });
    previewArea.addEventListener('dragleave', () => previewArea.classList.remove('dragover'));
    previewArea.addEventListener('drop', e => { e.preventDefault(); previewArea.classList.remove('dragover'); const file = e.dataTransfer.files[0]; if (file && file.type.startsWith('video/')) loadVideo(file); });
    input.addEventListener('change', e => { const file = e.target.files[0]; if (file && file.type.startsWith('video/')) loadVideo(file); });

    function loadVideo(file) {
      const url = URL.createObjectURL(file);
      previewArea.innerHTML = '';
      videoEl = document.createElement('video');
      videoEl.src = url; videoEl.controls = true;
      videoEl.style.maxHeight = '100%'; videoEl.style.maxWidth = '100%'; videoEl.style.borderRadius = '8px';
      previewArea.appendChild(videoEl);
      duration = 0;
      videoEl.addEventListener('loadedmetadata', () => {
        duration = videoEl.duration;
        initSegmentControls();
      });
    }

    function initSegmentControls() {
      // reset handle position
      handle.style.left = '0px';
      updateTimeLabel(0, duration);
      bindSegmentEvents();
    }

    function bindSegmentEvents() {
      // click on bar
      segmentBar.addEventListener('click', e => {
        const rect = segmentBar.getBoundingClientRect();
        const offset = e.clientX - rect.left;
        const t = (offset / rect.width) * duration;
        if (videoEl) videoEl.currentTime = t;
        handle.style.left = offset + 'px';
        updateTimeLabel(t, duration);
      });
      // drag handle
      let startX, startLeft;
      handle.addEventListener('mousedown', e => {
        e.stopPropagation(); e.preventDefault();
        startX = e.clientX; startLeft = handle.offsetLeft;
        document.documentElement.addEventListener('mousemove', doDrag);
        document.documentElement.addEventListener('mouseup', stopDrag);
      });
      function doDrag(e) {
        const rect = segmentBar.getBoundingClientRect();
        let delta = e.clientX - startX;
        let newLeft = Math.min(Math.max(0, startLeft + delta), rect.width);
        handle.style.left = newLeft + 'px';
        const t = (newLeft / rect.width) * duration;
        if (videoEl) videoEl.currentTime = t;
        updateTimeLabel(t, duration);
      }
      function stopDrag() {
        document.documentElement.removeEventListener('mousemove', doDrag);
        document.documentElement.removeEventListener('mouseup', stopDrag);
      }
    }

    function updateTimeLabel(start, end) {
      const fmt = t => { const m = Math.floor(t/60); const s = Math.floor(t%60).toString().padStart(2,'0'); return `${m}:${s}`; };
      timeLabel.textContent = `${fmt(start)} - ${fmt(end)}`;
    }
  </script>
  
  <!-- Scripts -->
  		<script src="/js/jquery.min.js"></script>
  		<script src="/js/jquery.scrollex.min.js"></script>
  		<script src="/js/jquery.scrolly.min.js"></script>
  		<script src="/js/browser.min.js"></script>
  		<script src="/js/breakpoints.min.js"></script>
  		<script src="/js/util.js"></script>
  		<script src="/js/main.js"></script>
</body>
</html>
