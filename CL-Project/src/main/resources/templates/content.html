<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ì˜ìƒ ì‹œì²­ - AIkademia</title>

  <!-- CSS íŒŒì¼ë“¤ -->
  <link rel="stylesheet" href="/css/main.css" />
  <link rel="stylesheet" href="/css/header.css" />
  <link rel="stylesheet" href="/css/login.css" />

  <style>
    :root{
      --bg:#2e3842; --panel:#242c35; --panel-2:#1f252c; --line:#3c4550;
      --text:#e7f1ff; --muted:#9fb3c8; --accent:#1f90ff; --marker:#1f90ff; --end:#ff7a59;
      --band:rgba(31,144,255,.18);
      --min-shell:1200px; --min-preview-h:420px; --min-timeline-h:200px;
    }
    *{ box-sizing:border-box; }
    body{ margin:0; background:var(--bg); color:#fff; font-family:Arial, Helvetica, sans-serif; }

    /* ===== í—¤ë” ë†’ì´ ê³ ë ¤í•œ íŒ¨ë”© ===== */
    body.content-page .viewer-container {
      padding-top: calc(64px + 24px) !important;
    }
    
    /* ===== 2ì—´ ë ˆì´ì•„ì›ƒ ===== */
    .viewer-container{ height:100vh; padding:24px; padding-top:calc(64px + 24px); display:flex; justify-content:center; align-items:center; overflow-x:auto; overflow-y:hidden; }
    .viewer-shell{ width:100%; max-width:1400px; min-width:var(--min-shell); height:calc(100vh - 64px - 48px); display:grid; gap:16px; grid-template-columns:minmax(700px,1fr) 560px; }

    /* ===== ì™¼ìª½ ì˜ìƒ ì˜ì—­ ===== */
    .viewer-inner{ display:flex; flex-direction:column; height:100%; background:var(--panel-2); border:1px solid var(--line); border-radius:8px; overflow:hidden; box-shadow:0 0 10px rgba(0,0,0,.3); min-width:700px; }
    .preview-area{ flex:1; position:relative; display:flex; align-items:center; justify-content:center; background:var(--panel-2); min-height:var(--min-preview-h); }
    .preview-area video, .preview-area img{ max-height:100%; max-width:100%; object-fit:contain; border-radius:8px; box-shadow:0 4px 20px rgba(0,0,0,.5); }
    .preview-area.has-chapter{ border:3px solid var(--accent); box-shadow:0 0 20px rgba(31,144,255,0.5); }
    
    /* êµ¬ê°„ ì¬ìƒ ì¤‘ ì˜¤ë²„ë ˆì´ */
    .chapter-overlay{ position:absolute; bottom:15px; left:15px; background:rgba(0,0,0,0.85); color:white; padding:10px 15px; border-radius:6px; font-size:13px; z-index:50; display:none; border-left:4px solid var(--accent); }
    .preview-area.has-chapter .chapter-overlay{ display:block; }
    
    /* X ë²„íŠ¼ */
    .close-button{ 
        position:absolute; 
        top:15px; 
        right:15px; 
        width:36px; 
        height:36px; 
        background:rgba(0,0,0,0.75); 
        color:white; 
        border:2px solid rgba(255,255,255,0.3); 
        border-radius:50%; 
        cursor:pointer; 
        font-size:18px; 
        font-weight:bold; 
        z-index:100; 
        display:none; 
        transition:all 0.2s; 
        padding:0; 
        align-items:center; 
        justify-content:center;
    }
    .close-button:hover{ 
        background:rgba(255,77,77,0.9); 
        border-color:rgba(255,255,255,0.6); 
        transform:scale(1.1); 
    }
    .preview-area.has-chapter .close-button{ 
        display:flex !important; 
    }

    /* ===== íƒ€ì„ë¼ì¸ ===== */
    .timeline-container{ position:relative; background:var(--panel); padding:48px 20px 20px; border-top:1px solid var(--line); min-height:var(--min-timeline-h); }
    .segment-bar{ position:absolute; top:12px; left:20px; right:20px; height:8px; background:rgba(255,255,255,.25); border-radius:4px; z-index:2; cursor:pointer; }
    
    /* ì‹œê°„ ë ˆì´ë¸” */
    .time-label{ position:absolute; top:28px; font-size:12px; color:rgba(255,255,255,.85); z-index:2; }
    .time-label.start{ left:20px; }
    .time-label.end{ right:20px; }

    .timeline{ display:flex; align-items:center; gap:10px; margin-top:28px; overflow-x:auto; padding-bottom:4px; }
    .timeline-item{ position:relative; flex:0 0 auto; width:130px; height:100px; background:#3d4754; border-radius:6px; transition:transform .2s; overflow:hidden; display:flex; align-items:center; justify-content:center; color:#c7d2de; font-size:12px; border:1px solid transparent; min-width:130px; min-height:100px; cursor:pointer; }
    .timeline-item:hover{ transform:scale(1.03); background:#505c6a; border-color:#637386; }
    .timeline-item img{ width:100%; height:100%; object-fit:cover; display:block; }
    .timeline-item .thumb-label{ position:absolute; left:6px; right:6px; bottom:6px; background:rgba(0,0,0,.45); color:#e7f1ff; font-size:11px; padding:2px 4px; border-radius:4px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
    .timeline-item.active{ border-color:var(--accent); box-shadow:0 0 0 2px var(--accent), 0 0 16px rgba(31,144,255,.35) inset; }

    /* ===== ì˜¤ë¥¸ìª½ ì˜ìƒ ëª©ë¡ íŒ¨ë„ (manage.htmlê³¼ ë™ì¼) ===== */
    .right-panel{ background:var(--panel); border:1px solid var(--line); border-radius:8px; box-shadow:0 0 10px rgba(0,0,0,.3); display:flex; flex-direction:column; min-width:560px; overflow:auto; }
    .panel-header{ padding:10px 12px; border-bottom:1px solid var(--line); font-size:12px; letter-spacing:2px; color:var(--muted); display:flex; align-items:center; justify-content:space-between; }
    
    /* ê²€ìƒ‰ì°½ (manage.htmlê³¼ ë™ì¼) */
    .search-wrapper{ padding:10px 12px; border-bottom:1px solid var(--line); }
    .search-input{ 
        width:100%;
        padding:10px 12px;
        background:rgba(255,255,255,0.1);
        border:1px solid rgba(255,255,255,0.2);
        border-radius:6px;
        color:white;
        font-size:14px;
    }
    .search-input::placeholder{ color:rgba(255,255,255,0.5); }
    .search-input:focus{ 
        outline:none;
        background:rgba(255,255,255,0.15);
        border-color:var(--accent);
    }
    
    /* ì˜ìƒ ëª©ë¡ */
    .video-list{ 
        flex:1; 
        overflow-y:auto; 
        padding:12px; 
        display:flex; 
        flex-direction:column; 
        gap:10px; 
    }
    
    /* ìŠ¤í¬ë¡¤ë°” ìŠ¤íƒ€ì¼ */
    .video-list::-webkit-scrollbar {
        width: 8px;
    }
    .video-list::-webkit-scrollbar-track {
        background: rgba(255,255,255,0.05);
        border-radius: 4px;
    }
    .video-list::-webkit-scrollbar-thumb {
        background: rgba(255,255,255,0.2);
        border-radius: 4px;
    }
    .video-list::-webkit-scrollbar-thumb:hover {
        background: rgba(255,255,255,0.3);
    }
    .video-card{ 
        background:var(--panel-2); 
        border:1px solid var(--line); 
        border-radius:8px; 
        padding:10px; 
        cursor:pointer; 
        position:relative; 
        display:flex; 
        gap:12px; 
        align-items:center; 
    }
    .video-card:hover{ 
        border-color:#637386; 
    }
    .video-card.active{ 
        border-color:var(--accent); 
        box-shadow:0 0 0 2px var(--accent) inset; 
    }
    
    .video-thumb-wrapper{ 
        width:120px; 
        height:90px; 
        background:var(--panel-2); 
        border-radius:6px; 
        flex-shrink:0; 
        display:flex; 
        align-items:center; 
        justify-content:center; 
        overflow:hidden; 
    }
    .video-thumb-wrapper img{ 
        width:100%; 
        height:100%; 
        object-fit:cover;
    }
    
    .video-info{ 
        flex:1; 
        display:flex; 
        flex-direction:column; 
        gap:8px; 
        min-width:0; 
    }
    .video-name{ 
        font-weight:700; 
        font-size:14px; 
        color:white; 
        white-space:nowrap; 
        overflow:hidden; 
        text-overflow:ellipsis; 
    }
    .video-meta{ 
        font-size:11px; 
        color:#c9d6e3; 
        display:flex; 
        flex-direction:column; 
        gap:4px; 
    }
    .video-meta-row{
        display:flex;
        justify-content:space-between;
        align-items:center;
    }
    .chapter-count{ 
        background:rgba(31,144,255,0.2); 
        color:var(--accent); 
        padding:2px 8px; 
        border-radius:4px; 
        font-size:10px; 
        font-weight:600; 
    }

    /* ë¹ˆ ìƒíƒœ */
    .empty-state{ 
        padding:40px 20px; 
        text-align:center; 
        color:var(--muted); 
    }
    .empty-state-icon{ 
        font-size:48px; 
        margin-bottom:12px; 
        opacity:0.5; 
    }
    
    /* ===== ì™¼ìª½ ì‚¬ì´ë“œë°” (manage.htmlì—ì„œ ë³µì‚¬) ===== */
    .sidebar-toggle{
        position:fixed;
        left:0;
        top:50%;
        transform:translateY(-50%);
        width:24px;
        height:60px;
        background:rgba(255,255,255,0.1);
        border:1px solid rgba(255,255,255,0.2);
        border-left:none;
        border-radius:0 8px 8px 0;
        backdrop-filter:blur(10px);
        color:white;
        font-size:16px;
        cursor:pointer;
        display:flex;
        align-items:center;
        justify-content:center;
        z-index:999;
        transition:left 0.3s ease;
        padding:0 6px;
    }
    .sidebar-toggle:hover{
        background:rgba(255,255,255,0.2);
        padding:0 7px;
    }
    .sidebar-toggle.open{
        left:360px;
    }
    
    .left-sidebar{
        position:fixed;
        left:-360px;
        top:64px;
        width:360px;
        height:calc(100vh - 64px);
        background:rgba(46,56,66,0.95);
        border-right:1px solid var(--line);
        backdrop-filter:blur(20px);
        z-index:998;
        transition:left 0.3s ease;
        display:flex;
        flex-direction:column;
        box-shadow:2px 0 20px rgba(0,0,0,0.3);
    }
    .left-sidebar.open{
        left:0;
    }
    
    .sidebar-header{
        padding:16px;
        border-bottom:1px solid var(--line);
        background:rgba(0,0,0,0.2);
    }
    
    .sidebar-search{
        width:100%;
        padding:10px 12px;
        background:rgba(255,255,255,0.1);
        border:1px solid rgba(255,255,255,0.2);
        border-radius:6px;
        color:white;
        font-size:14px;
    }
    .sidebar-search::placeholder{
        color:rgba(255,255,255,0.5);
    }
    .sidebar-search:focus{
        outline:none;
        background:rgba(255,255,255,0.15);
        border-color:var(--accent);
    }
    
    .sidebar-content{
        flex:1;
        overflow-y:auto;
        padding:12px;
    }
    
    /* ìŠ¤í¬ë¡¤ë°” ìŠ¤íƒ€ì¼ */
    .sidebar-content::-webkit-scrollbar {
        width: 8px;
    }
    .sidebar-content::-webkit-scrollbar-track {
        background: rgba(255,255,255,0.05);
        border-radius: 4px;
    }
    .sidebar-content::-webkit-scrollbar-thumb {
        background: rgba(255,255,255,0.2);
        border-radius: 4px;
    }
    .sidebar-content::-webkit-scrollbar-thumb:hover {
        background: rgba(255,255,255,0.3);
    }
    
    .video-list-item{
        background:rgba(255,255,255,0.05);
        border:1px solid rgba(255,255,255,0.1);
        border-radius:8px;
        padding:12px;
        margin-bottom:12px;
        cursor:pointer;
        transition:all 0.2s;
        position:relative;
    }
    .video-list-item:hover{
        background:rgba(255,255,255,0.1);
        border-color:var(--accent);
    }
    .video-list-item.active{
        border-color:var(--accent);
        box-shadow:0 0 0 2px var(--accent) inset;
    }
    
    .video-thumb{
        width:100%;
        height:120px;
        background:var(--panel-2);
        border-radius:6px;
        margin-bottom:8px;
        object-fit:cover;
        display:flex;
        align-items:center;
        justify-content:center;
        color:white;
        font-size:32px;
    }
    
    .video-info{
        font-size:13px;
    }
    .video-title{
        font-weight:700;
        color:white;
        margin-bottom:4px;
        white-space:nowrap;
        overflow:hidden;
        text-overflow:ellipsis;
    }
    .video-meta{
        font-size:11px;
        color:var(--muted);
    }
    
    /* ===== ì˜¤ë¥¸ìª½ ì±•í„° íŒ¨ë„ ìŠ¤íƒ€ì¼ ===== */
    .chapters{ 
        padding:12px; 
        display:flex; 
        flex-direction:column; 
        gap:10px; 
        overflow:auto; 
        height:100%;
    }
    .chapters::-webkit-scrollbar {
        width: 8px;
    }
    .chapters::-webkit-scrollbar-track {
        background: rgba(255,255,255,0.05);
        border-radius: 4px;
    }
    .chapters::-webkit-scrollbar-thumb {
        background: rgba(255,255,255,0.2);
        border-radius: 4px;
    }
    .chapters::-webkit-scrollbar-thumb:hover {
        background: rgba(255,255,255,0.3);
    }
    
    .chapter-card{ 
        background:var(--panel-2); 
        border:1px solid var(--line); 
        border-radius:8px; 
        padding:10px; 
        cursor:pointer; 
        position:relative; 
        display:grid; 
        gap:6px; 
    }
    .chapter-card:hover{ 
        border-color:#637386; 
    }
    .chapter-card.active{ 
        border-color:var(--accent); 
        box-shadow:0 0 0 2px var(--accent) inset; 
    }
    .chapter-title{ 
        font-weight:700; 
        font-size:14px; 
    }
    .chapter-time{ 
        font-size:12px; 
        color:#c9d6e3; 
    }
    .chapter-summary{ 
        font-size:13px; 
        color:#e7f1ff; 
        opacity:.95; 
    }
    
    /* í™•ì¥ëœ ì±•í„° ì¹´ë“œ ìŠ¤íƒ€ì¼ */
    .chapter-card.expanded {
        background: rgba(31,144,255,0.08);
        border-color: var(--accent);
    }
    
    /* ìƒì„¸ ì„¤ëª… í‘œì‹œ ì˜ì—­ */
    .chapter-detail {
      display: none;
      margin-top: 10px;
      padding: 12px;
      background: rgba(255,255,255,0.05);
      border-left: 3px solid var(--accent);
      border-radius: 4px;
      font-size:13px;
      line-height:1.6;
      color:#e7f1ff;
    }
    .chapter-detail.active {
      display: block;
    }
    .chapter-detail.loading {
      text-align: center;
      color: var(--muted);
    }
    
    /* ë¡œë”© ìŠ¤í”¼ë„ˆ */
    .spinner {
      border: 3px solid rgba(255,255,255,0.3);
      border-top-color: var(--accent);
      border-radius: 50%;
      width: 24px;
      height: 24px;
      animation: spin 0.8s linear infinite;
      margin: 0 auto;
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
  </style>
</head>
<body class="generic-page content-page">
  <!-- Page Wrapper -->
  <div id="page-wrapper" data-header-loaded="true">
    <!-- Header Fragment -->
    <div th:replace="~{fragments/header :: header}"></div>
  </div>
  
  <!-- ì‚¬ì´ë“œë°” í† ê¸€ ë²„íŠ¼ -->
  <button class="sidebar-toggle" id="sidebar-toggle">â–¶</button>
  
  <!-- ì™¼ìª½ ì‚¬ì´ë“œë°” -->
  <div class="left-sidebar" id="left-sidebar">
    <div class="sidebar-header">
      <input type="text" class="sidebar-search" id="video-search" placeholder="ì˜ìƒ ê²€ìƒ‰...">
    </div>
    <div class="sidebar-content" id="video-list">
      <!-- ì˜ìƒ ëª©ë¡ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
    </div>
  </div>
  
  <div class="viewer-container">
    <div class="viewer-shell">
      <!-- ===== ì™¼ìª½: ì˜ìƒ í”Œë ˆì´ì–´ + êµ¬ê°„ íƒ€ì„ë¼ì¸ ===== -->
      <div class="viewer-inner">
        <div class="preview-area" id="preview-area">
          <div id="video-wrapper" style="position:relative; max-width:100%; max-height:100%; display:flex; align-items:center; justify-content:center;">
            <img id="preview-media" alt="video preview" src="https://via.placeholder.com/800x450/2e3842/9fb3c8?text=%EC%98%81%EC%83%81%EC%9D%84+%EC%84%A0%ED%83%9D%ED%95%98%EC%84%B8%EC%9A%94"/>
          </div>
          <div class="chapter-overlay" id="chapter-overlay">
            <div style="font-weight:bold; margin-bottom:4px;">ğŸ¬ êµ¬ê°„ ì¬ìƒ ì¤‘</div>
            <div id="overlay-info" style="font-size:12px; opacity:0.9;"></div>
          </div>
          <button class="close-button" id="close-button" title="ì›ë³¸ ì˜ìƒìœ¼ë¡œ ëŒì•„ê°€ê¸°">Ã—</button>
        </div>

        <div class="timeline-container">
          <div class="segment-bar" id="segment-bar"></div>
          <span class="time-label start" id="time-label-start">0:00</span>
          <span class="time-label end" id="time-label-end">0:00</span>

          <div class="timeline" id="timeline">
            <!-- êµ¬ê°„ ì¸ë„¤ì¼ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
          </div>
        </div>
      </div>

      <!-- ===== ì˜¤ë¥¸ìª½: ì±•í„° ëª©ë¡ íŒ¨ë„ ===== -->
      <aside class="right-panel">
        <div class="panel-header">CHAPTERS</div>
        <div id="chapters" class="chapters">
          <div class="empty-state">
            <div class="empty-state-icon">ğŸ“š</div>
            <div>ì˜ìƒì„ ì„ íƒí•˜ì„¸ìš”</div>
          </div>
        </div>
      </aside>
    </div>
  </div>

  <script>
    console.log('ğŸ¬ Content í˜ì´ì§€ ìŠ¤í¬ë¦½íŠ¸ ì‹œì‘');
    
    /* ===== ìš”ì†Œ ì°¸ì¡° ===== */
    const previewArea = document.getElementById('preview-area');
    const videoWrapper = document.getElementById('video-wrapper');
    const segmentBar = document.getElementById('segment-bar');
    const timeLabelStart = document.getElementById('time-label-start');
    const timeLabelEnd = document.getElementById('time-label-end');
    const timeline = document.getElementById('timeline');
    const videoListEl = document.getElementById('video-list');
    const videoSearchEl = document.getElementById('video-search');
    const closeButton = document.getElementById('close-button');
    const chapterOverlay = document.getElementById('chapter-overlay');
    const overlayInfo = document.getElementById('overlay-info');
    const chaptersWrap = document.getElementById('chapters');
    const sidebarToggle = document.getElementById('sidebar-toggle');
    const leftSidebar = document.getElementById('left-sidebar');

    let videoEl = null;
    let duration = 0;
    let currentStoredName = null;
    let currentChapters = [];
    let currentSegments = []; // â˜… NEW: ìë§‰ ì„¸ê·¸ë¨¼íŠ¸ ì €ì¥
    let currentDetectedLang = 'ko'; // â˜… NEW: ê°ì§€ëœ ì–¸ì–´
    let currentChapter = null; // í˜„ì¬ ì¬ìƒ ì¤‘ì¸ êµ¬ê°„
    let allVideos = []; // ì „ì²´ ì˜ìƒ ëª©ë¡
    let explanationQueue = []; // â˜… NEW: ì„¤ëª… ìš”ì²­ í
    let isProcessingExplanation = false; // â˜… NEW: í ì²˜ë¦¬ ì¤‘ í”Œë˜ê·¸
    let hasUserStartedPlayback = false; // â˜… NEW: ì‚¬ìš©ìê°€ ì¬ìƒì„ ì‹œì‘í–ˆëŠ”ì§€ ì—¬ë¶€

    /* ===== ìœ í‹¸ í•¨ìˆ˜ ===== */
    function formatTime(seconds) {
      const m = Math.floor(seconds / 60);
      const s = Math.floor(seconds % 60).toString().padStart(2, '0');
      return `${m}:${s}`;
    }

    function updateTimeLabel(start, end) {
      timeLabelStart.textContent = formatTime(start);
      timeLabelEnd.textContent = formatTime(end);
    }

    /* ===== ì˜ìƒ ëª©ë¡ ë¡œë“œ ===== */
    async function loadVideoList() {
      try {
        console.log('ğŸ“‹ ì˜ìƒ ëª©ë¡ ë¡œë“œ ì¤‘...');
        const response = await fetch('/api/videos');
        if (!response.ok) throw new Error('ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨');
        
        allVideos = await response.json();
        console.log('âœ… ì˜ìƒ ëª©ë¡ ë¡œë“œ ì™„ë£Œ:', allVideos.length, 'ê°œ');
        
        renderVideoList(allVideos);
      } catch (error) {
        console.error('âŒ ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨:', error);
        videoListEl.innerHTML = `
          <div class="empty-state">
            <div class="empty-state-icon">âš ï¸</div>
            <div>ì˜ìƒ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</div>
          </div>
        `;
      }
    }

    /* ===== ì˜ìƒ ëª©ë¡ ë Œë”ë§ (ì‚¬ì´ë“œë°”ìš©) ===== */
    function renderVideoList(videos) {
      if (videos.length === 0) {
        videoListEl.innerHTML = '<div style="padding:20px; text-align:center; color:#999;">ì €ì¥ëœ ì˜ìƒì´ ì—†ìŠµë‹ˆë‹¤.</div>';
        return;
      }
      
      videoListEl.innerHTML = '';
      videos.forEach(video => {
        const item = document.createElement('div');
        item.className = 'video-list-item';
        item.dataset.videoId = video.videoId;
        item.dataset.storedName = video.storedName;
        
        // ì¸ë„¤ì¼
        const thumb = document.createElement('div');
        thumb.className = 'video-thumb';
        thumb.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
        thumb.textContent = 'ğŸ¬';
        
        // ì˜ìƒ ì •ë³´
        const info = document.createElement('div');
        info.className = 'video-info';
        
        const title = document.createElement('div');
        title.className = 'video-title';
        title.textContent = video.userName;
        
        const meta = document.createElement('div');
        meta.className = 'video-meta';
        const duration = Math.floor(video.duration);
        const minutes = Math.floor(duration / 60);
        const seconds = duration % 60;
        meta.textContent = `${minutes}:${seconds.toString().padStart(2, '0')} â€¢ ${new Date(video.createdAt).toLocaleDateString('ko-KR')}`;
        
        info.appendChild(title);
        info.appendChild(meta);
        
        item.appendChild(thumb);
        item.appendChild(info);
        
        // í´ë¦­ ì´ë²¤íŠ¸
        item.addEventListener('click', () => {
          loadVideo(video.storedName);
        });
        
        videoListEl.appendChild(item);
      });
    }
    
    /* ===== ì‚¬ì´ë“œë°” í† ê¸€ ===== */
    sidebarToggle.addEventListener('click', () => {
      const isOpen = leftSidebar.classList.toggle('open');
      sidebarToggle.classList.toggle('open');
      sidebarToggle.textContent = isOpen ? 'â—€' : 'â–¶';
      
      if (isOpen && allVideos.length === 0) {
        loadVideoList();
      }
    });

    /* ===== ê²€ìƒ‰ ê¸°ëŠ¥ ===== */
    videoSearchEl.addEventListener('input', (e) => {
      const searchTerm = e.target.value.toLowerCase();
      const filtered = allVideos.filter(v => 
        v.userName.toLowerCase().includes(searchTerm)
      );
      renderVideoList(filtered);
    });

    /* ===== ì˜ìƒ ë¡œë“œ ===== */
    async function loadVideo(storedName) {
      try {
        console.log('ğŸ“‚ ì˜ìƒ ë¡œë“œ:', storedName);
        
        // â˜… NEW: í”Œë˜ê·¸ ì´ˆê¸°í™”
        hasUserStartedPlayback = false;
        
        // ì˜ìƒ ì •ë³´ ë° ì±•í„° ì •ë³´ ê°€ì ¸ì˜¤ê¸°
        const response = await fetch(`/api/videos/${storedName}`);
        if (!response.ok) throw new Error('ì˜ìƒ ì •ë³´ ë¡œë“œ ì‹¤íŒ¨');
        
        const data = await response.json();
        console.log('âœ… ì˜ìƒ ì •ë³´:', data);
        
        const video = data.video;
        const chapters = data.chapters;
        
        // â˜… NEW: segmentsì™€ ì–¸ì–´ ì €ì¥
        currentSegments = video.segments || [];
        currentDetectedLang = video.detectedLang || 'ko';
        console.log('âœ… Segments ì €ì¥:', currentSegments.length, 'ê°œ');
        console.log('âœ… ì–¸ì–´ ì„¤ì •:', currentDetectedLang);
        
        // ë¹„ë””ì˜¤ ì—˜ë¦¬ë¨¼íŠ¸ ìƒì„±
        const videoUrl = `/api/videos/stream/${storedName}`;
        videoWrapper.innerHTML = '';
        
        videoEl = document.createElement('video');
        videoEl.src = videoUrl;
        videoEl.controls = true;
        videoEl.style.maxHeight = '100%';
        videoEl.style.maxWidth = '100%';
        videoEl.style.objectFit = 'contain';
        videoWrapper.appendChild(videoEl);
        
        // ë©”íƒ€ë°ì´í„° ë¡œë“œ ëŒ€ê¸°
        await new Promise((resolve, reject) => {
          videoEl.addEventListener('loadedmetadata', resolve, { once: true });
          videoEl.addEventListener('error', reject, { once: true });
        });
        
        currentStoredName = storedName;
        duration = video.duration;
        updateTimeLabel(0, duration);
        
        // â˜… NEW: ì˜ìƒ ì¬ìƒ ì¤‘ í™œì„± ì±•í„° ì¶”ì  ë³€ìˆ˜
        let lastActiveChapter = -1;
        
        // â˜… NEW: ì‚¬ìš©ìê°€ ì¬ìƒ ë²„íŠ¼ì„ ëˆ„ë¥¼ ë•Œ í”Œë˜ê·¸ ì„¤ì • ë° ì±•í„° ë¦¬ì…‹
        videoEl.addEventListener('play', () => {
          hasUserStartedPlayback = true;
          lastActiveChapter = -1; // â˜… ë¦¬ì…‹í•˜ì—¬ ì²« ì±•í„° ì¬ê°ì§€
          console.log('â–¶ï¸ ì¬ìƒ ì‹œì‘ - ìë™ ë¡œë“œ í™œì„±í™” (lastActiveChapter ë¦¬ì…‹)');
        }, { once: true });
        
        // â˜… NEW: ì˜ìƒ ì¬ìƒ ì¤‘ í™œì„± ì±•í„° UI ì—…ë°ì´íŠ¸
        videoEl.addEventListener('timeupdate', () => {
          const currentTime = videoEl.currentTime;
          
          // í˜„ì¬ ì¬ìƒ ì‹œì ì´ ì†í•œ ì±•í„° ì°¾ê¸°
          const activeChapterIdx = currentChapters.findIndex(ch => 
            currentTime >= ch.start && currentTime < ch.end
          );
          
          // ì±•í„°ê°€ ë³€ê²½ë˜ì—ˆì„ ë•Œë§Œ ì²˜ë¦¬
          if (activeChapterIdx !== -1 && activeChapterIdx !== lastActiveChapter) {
            lastActiveChapter = activeChapterIdx;
            
            // â˜… í™œì„± ì±•í„° UI ì—…ë°ì´íŠ¸ + ì¡°ê±´ë¶€ ìë™ ì„¤ëª… ë¡œë“œ
            document.querySelectorAll('.chapter-card').forEach(card => {
              card.classList.remove('active');
            });
            const activeCard = document.querySelector(`[data-chapter-id="${activeChapterIdx}"]`);
            if (activeCard) {
              activeCard.classList.add('active');
              // í™œì„± ì¹´ë“œë¡œ ìŠ¤í¬ë¡¤
              activeCard.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
              
              // â˜… ì‚¬ìš©ìê°€ ì¬ìƒ ë²„íŠ¼ì„ ëˆ„ë¥¸ í›„ì—ë§Œ ìë™ ë¡œë“œ
              if (hasUserStartedPlayback) {
                const detailDiv = activeCard.querySelector('.chapter-detail');
                if (detailDiv && detailDiv.dataset.loaded !== 'true' && detailDiv.dataset.loading !== 'true') {
                  queueExplanationRequest(activeChapterIdx);
                }
              }
            }
            
            console.log(`ğŸ¯ í™œì„± ì±•í„°: ${activeChapterIdx + 1}. ${currentChapters[activeChapterIdx].title}`);
          }
        });
        
        // ì±•í„° ë°ì´í„° ë³€í™˜
        currentChapters = chapters.map(ch => ({
          start: ch.startTime,
          end: ch.endTime,
          title: ch.title,
          summary: ch.summary
        }));
        
        // íƒ€ì„ë¼ì¸ ë Œë”ë§
        renderTimeline(currentChapters);
        
        // â˜… NEW: ì±•í„° ë¦¬ìŠ¤íŠ¸ ë Œë”ë§ (ì˜¤ë¥¸ìª½ íŒ¨ë„)
        renderChaptersList(currentChapters);
        
        // í™œì„± ìƒíƒœ ì—…ë°ì´íŠ¸
        document.querySelectorAll('.video-list-item').forEach(el => el.classList.remove('active'));
        const activeItem = document.querySelector(`[data-stored-name="${storedName}"]`);
        if (activeItem) activeItem.classList.add('active');
        
        console.log('âœ… ì˜ìƒ ë¡œë“œ ì™„ë£Œ');
        
      } catch (error) {
        console.error('âŒ ì˜ìƒ ë¡œë“œ ì‹¤íŒ¨:', error);
        alert('ì˜ìƒ ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤:\n' + error.message);
      }
    }

    /* ===== íƒ€ì„ë¼ì¸ ë Œë”ë§ ===== */
    async function renderTimeline(chapters) {
      timeline.innerHTML = '';
      
      if (chapters.length === 0) {
        timeline.innerHTML = '<div style="padding:20px; color:var(--muted);">êµ¬ê°„ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
        return;
      }
      
      // â˜… NEW: í˜„ì¬ ì¬ìƒ ì‹œì  ì €ì¥ (ì´ˆê¸° ë¡œë“œ ì‹œ 0ì´ˆ ìœ ì§€ìš©)
      const originalTime = videoEl ? videoEl.currentTime : 0;
      
      for (let i = 0; i < chapters.length; i++) {
        const ch = chapters[i];
        const item = document.createElement('div');
        item.className = 'timeline-item';
        item.dataset.index = i;
        
        // ì¸ë„¤ì¼ ìº¡ì²˜
        try {
          const thumbUrl = await captureFrame(ch.start);
          item.innerHTML = `
            <img src="${thumbUrl}" alt="${ch.title}">
            <div class="thumb-label">${i + 1}. ${ch.title}</div>
          `;
        } catch (err) {
          console.error('ì¸ë„¤ì¼ ìº¡ì²˜ ì‹¤íŒ¨:', err);
          item.innerHTML = `<div class="thumb-label">${i + 1}. ${ch.title}</div>`;
        }
        
        // í´ë¦­ ì´ë²¤íŠ¸ - ì‹œì  ì´ë™
        item.addEventListener('click', () => {
          seekToTime(ch.start);
        });
        
        timeline.appendChild(item);
      }
      
      // â˜… NEW: ì›ë˜ ì‹œì ìœ¼ë¡œ ë³µê·€ (ì´ˆê¸° ë¡œë“œ ì‹œ 0ì´ˆ)
      if (videoEl) {
        videoEl.currentTime = originalTime;
        console.log('âœ… íƒ€ì„ë¼ì¸ ë Œë”ë§ ì™„ë£Œ, ì‹œì  ë³µê·€:', originalTime, 'ì´ˆ');
      }
    }

    /* ===== í”„ë ˆì„ ìº¡ì²˜ ===== */
    function captureFrame(time) {
      return new Promise((resolve, reject) => {
        if (!videoEl) return reject(new Error('ì˜ìƒ ì—†ìŒ'));
        
        const onSeeked = () => {
          try {
            const canvas = document.createElement('canvas');
            const w = videoEl.videoWidth || 640;
            const h = videoEl.videoHeight || 360;
            canvas.width = w;
            canvas.height = h;
            canvas.getContext('2d').drawImage(videoEl, 0, 0, w, h);
            const url = canvas.toDataURL('image/jpeg', 0.85);
            videoEl.removeEventListener('seeked', onSeeked);
            resolve(url);
          } catch (err) {
            videoEl.removeEventListener('seeked', onSeeked);
            reject(err);
          }
        };
        
        videoEl.addEventListener('seeked', onSeeked, { once: true });
        videoEl.currentTime = Math.min(Math.max(0, time), duration || 0);
      });
    }

    /* ===== êµ¬ê°„ ì¬ìƒ ===== */
    async function playChapter(index) {
      const chapter = currentChapters[index];
      if (!chapter) return;
      
      console.log(`êµ¬ê°„ ì¬ìƒ: ${chapter.title} (${chapter.start}s ~ ${chapter.end}s)`);
      
      try {
        // Flaskë¡œ êµ¬ê°„ ì˜ìƒ ìš”ì²­
          const videoResponse = await fetch(`/api/videos/stream/${currentStoredName}`);
        if (!videoResponse.ok) throw new Error('ì˜ìƒ ë¡œë“œ ì‹¤íŒ¨');
          const videoBlob = await videoResponse.blob();
        
        const fd = new FormData();
          fd.append('file', videoBlob, currentStoredName);
        fd.append('start', chapter.start);
        fd.append('end', chapter.end);
        
        const res = await fetch('http://localhost:5001/clip', {
          method: 'POST',
          body: fd
        });
        
        if (!res.ok) throw new Error('êµ¬ê°„ ì˜ìƒ ìƒì„± ì‹¤íŒ¨');
        
        const blob = await res.blob();
        const clipUrl = URL.createObjectURL(blob);
        
        // êµ¬ê°„ ì˜ìƒ í‘œì‹œ
        videoWrapper.innerHTML = '';
        const clipVideo = document.createElement('video');
        clipVideo.src = clipUrl;
        clipVideo.controls = true;
        clipVideo.style.maxHeight = '100%';
        clipVideo.style.maxWidth = '100%';
        clipVideo.style.objectFit = 'contain';
        clipVideo.autoplay = true;
        clipVideo.loop = true;
        videoWrapper.appendChild(clipVideo);
        
        currentChapter = { ...chapter, clipUrl, clipVideo };
        previewArea.classList.add('has-chapter');
        
        // ì˜¤ë²„ë ˆì´ ì •ë³´ ì—…ë°ì´íŠ¸
          overlayInfo.innerHTML = `
          <div style="margin-bottom:2px;"><strong>${chapter.title}</strong></div>
          <div style="opacity:0.8;">${chapter.start.toFixed(1)}s ~ ${chapter.end.toFixed(1)}s (${(chapter.end - chapter.start).toFixed(1)}ì´ˆ)</div>
        `;
        
        // íƒ€ì„ë¼ì¸ í™œì„±í™”
        document.querySelectorAll('.timeline-item').forEach(el => el.classList.remove('active'));
        const activeItem = timeline.querySelector(`[data-index="${index}"]`);
        if (activeItem) activeItem.classList.add('active');
        
        console.log('âœ… êµ¬ê°„ ì¬ìƒ ì‹œì‘');
        
      } catch (error) {
        console.error('âŒ êµ¬ê°„ ì¬ìƒ ì‹¤íŒ¨:', error);
        alert('êµ¬ê°„ ì˜ìƒ ì¬ìƒ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤:\n' + error.message);
      }
    }

    /* ===== ì›ë³¸ ì˜ìƒìœ¼ë¡œ ë³µê·€ ===== */
    function returnToOriginal() {
      console.log('ì›ë³¸ ì˜ìƒìœ¼ë¡œ ë³µê·€');
      
      if (currentChapter && currentChapter.clipUrl) {
        URL.revokeObjectURL(currentChapter.clipUrl);
      }
      
      currentChapter = null;
      previewArea.classList.remove('has-chapter');
      
      // ì›ë³¸ ì˜ìƒ ë‹¤ì‹œ ë¡œë“œ
      if (currentStoredName) {
        const videoUrl = `/api/videos/stream/${currentStoredName}`;
      videoWrapper.innerHTML = '';
      
        videoEl = document.createElement('video');
        videoEl.src = videoUrl;
        videoEl.controls = true;
        videoEl.style.maxHeight = '100%';
        videoEl.style.maxWidth = '100%';
        videoEl.style.objectFit = 'contain';
        videoWrapper.appendChild(videoEl);
      }
      
      // í™œì„± ìƒíƒœ í•´ì œ
      document.querySelectorAll('.timeline-item').forEach(el => el.classList.remove('active'));
      
      console.log('âœ… ì›ë³¸ ì˜ìƒ ë³µê·€ ì™„ë£Œ');
    }

    /* ===== ì‹œì  ì´ë™ í•¨ìˆ˜ ===== */
    function seekToTime(time) {
      if (!videoEl || !duration) return;
      
      videoEl.currentTime = Math.max(0, Math.min(duration, time));
      console.log(`â© ì‹œì  ì´ë™: ${formatTime(time)}`);
    }

    /* ===== ì„¸ê·¸ë¨¼íŠ¸ ë°” í´ë¦­ - ì‹œì  ì´ë™ ===== */
    segmentBar.addEventListener('click', (e) => {
      if (!videoEl || !duration) return;
      
      const rect = segmentBar.getBoundingClientRect();
      const clickX = e.clientX - rect.left;
      const clickTime = (clickX / rect.width) * duration;
      
      if (currentChapter && currentChapter.clipVideo) {
        // êµ¬ê°„ ì˜ìƒ ì¬ìƒ ì¤‘
        const relativeTime = clickTime - currentChapter.start;
        currentChapter.clipVideo.currentTime = Math.max(0, Math.min(currentChapter.end - currentChapter.start, relativeTime));
        } else {
        // ì›ë³¸ ì˜ìƒ ì¬ìƒ ì¤‘
        videoEl.currentTime = Math.max(0, Math.min(duration, clickTime));
      }
    });

    /* ===== X ë²„íŠ¼ í´ë¦­ ===== */
    closeButton.addEventListener('click', (e) => {
          e.stopPropagation();
      returnToOriginal();
    });
    
    /* ===== ì±•í„° ë¦¬ìŠ¤íŠ¸ ë Œë”ë§ (ì˜¤ë¥¸ìª½ íŒ¨ë„) ===== */
    function renderChaptersList(chapters) {
      if (!chapters || chapters.length === 0) {
        chaptersWrap.innerHTML = `
          <div class="empty-state">
            <div class="empty-state-icon">ğŸ“š</div>
            <div>êµ¬ê°„ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤</div>
          </div>
        `;
        return;
      }
      
      chaptersWrap.innerHTML = '';
      chapters.forEach((ch, idx) => {
        const card = document.createElement('div');
        card.className = 'chapter-card';
        card.dataset.chapterId = idx;
        
        const title = document.createElement('div');
        title.className = 'chapter-title';
        title.textContent = `${idx + 1}. ${ch.title}`;
        
        const time = document.createElement('div');
        time.className = 'chapter-time';
        time.textContent = `${formatTime(ch.start)} â†’ ${formatTime(ch.end)}`;
        
        const summary = document.createElement('div');
        summary.className = 'chapter-summary';
        summary.textContent = ch.summary || '';
        
        // ìƒì„¸ ì„¤ëª… ì˜ì—­
        const detailDiv = document.createElement('div');
        detailDiv.className = 'chapter-detail';
        detailDiv.dataset.chapterId = idx;
        
        card.appendChild(title);
        card.appendChild(time);
        card.appendChild(summary);
        card.appendChild(detailDiv);
        
        // ì±•í„° ì¹´ë“œ í´ë¦­ â†’ ìƒì„¸ ì„¤ëª… í™•ì¥/ì¶•ì†Œ + ì‹œì  ì´ë™
        card.addEventListener('click', async (e) => {
          const detailDiv = card.querySelector('.chapter-detail');
          
          // â˜… NEW: ì‹œì  ì´ë™ (ì„¤ëª… ë¡œë“œ ì „ì— ì‹¤í–‰)
          seekToTime(ch.start);
          
          // ì´ë¯¸ ë¡œë“œëœ ê²½ìš° í† ê¸€ë§Œ
          if (detailDiv.dataset.loaded === 'true') {
            const isActive = detailDiv.classList.toggle('active');
            card.classList.toggle('expanded', isActive);
            console.log(`ì±•í„° ${idx} í† ê¸€: ${isActive ? 'í™•ì¥' : 'ì¶•ì†Œ'}`);
            return;
          }
          
          // â˜… ì²« í´ë¦­: íì— ì¶”ê°€í•˜ì—¬ ì„¤ëª… ë¡œë“œ
          console.log(`ì±•í„° ${idx} í´ë¦­ â†’ íì— ì¶”ê°€`);
          await queueExplanationRequest(idx);
        });
        
        chaptersWrap.appendChild(card);
      });
    }
    
    /* ===== ìš”ì²­ í ì‹œìŠ¤í…œ ===== */
    async function queueExplanationRequest(chapterId) {
      console.log(`ğŸ“ íì— ì¶”ê°€ ìš”ì²­: ì±•í„° ${chapterId}`);
      
      const card = document.querySelector(`[data-chapter-id="${chapterId}"]`);
      const detailDiv = card?.querySelector('.chapter-detail');
      
      // ì´ë¯¸ ë¡œë“œëœ ê²½ìš° ìŠ¤í‚µ
      if (detailDiv?.dataset.loaded === 'true') {
        console.log(`âš ï¸ ì±•í„° ${chapterId} ì´ë¯¸ ë¡œë“œë¨`);
        return;
      }
      
      // ì´ë¯¸ íì— ìˆìœ¼ë©´ ì¶”ê°€ ì•ˆ í•¨
      if (explanationQueue.includes(chapterId)) {
        console.log(`âš ï¸ ì´ë¯¸ íì— ìˆìŒ: ì±•í„° ${chapterId}`);
        return;
      }
      
      explanationQueue.push(chapterId);
      console.log(`âœ… í ì¶”ê°€ ì™„ë£Œ (í í¬ê¸°: ${explanationQueue.length}ê°œ)`);
      
      // â˜… íì— ì¶”ê°€ë˜ìë§ˆì ì¦‰ì‹œ ë¡œë”© í‘œì‹œ
      if (detailDiv && detailDiv.dataset.loading !== 'true') {
        detailDiv.classList.add('active');
        detailDiv.innerHTML = '<div class="spinner"></div><p>ëŒ€ê¸° ì¤‘...</p>';
        card?.classList.add('expanded');
        console.log(`ğŸ”„ ë¡œë”© í‘œì‹œ: ì±•í„° ${chapterId} (ëŒ€ê¸° ì¤‘)`);
      }
      
      if (!isProcessingExplanation) {
        await processExplanationQueue();
      }
    }
    
    async function processExplanationQueue() {
      if (explanationQueue.length === 0) {
        isProcessingExplanation = false;
        console.log('âœ… í ì²˜ë¦¬ ì™„ë£Œ');
        return;
      }
      
      isProcessingExplanation = true;
      const chapterId = explanationQueue.shift();
      
      console.log(`ğŸ”„ í ì²˜ë¦¬ ì¤‘: ì±•í„° ${chapterId} (ë‚¨ì€ í: ${explanationQueue.length}ê°œ)`);
      
      try {
        await loadChapterExplanation(chapterId);
      } catch (error) {
        console.error(`âŒ í ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜: ì±•í„° ${chapterId}`, error);
      }
      
      // ë‹¤ìŒ ìš”ì²­ ì²˜ë¦¬ (500ms ë”œë ˆì´ - Flask ë©”ëª¨ë¦¬ ì•ˆì •í™”)
      setTimeout(() => processExplanationQueue(), 500);
    }
    
    /* ===== ì±•í„° ìƒì„¸ ì„¤ëª… ë¡œë“œ ===== */
    async function loadChapterExplanation(chapterId) {
      const card = document.querySelector(`[data-chapter-id="${chapterId}"]`);
      if (!card) {
        console.log(`âš ï¸ ì±•í„° ${chapterId} ì¹´ë“œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ`);
        return;
      }
      
      const detailDiv = card.querySelector('.chapter-detail');
      if (!detailDiv) {
        console.log(`âš ï¸ ì±•í„° ${chapterId} detailDivë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ`);
        return;
      }
      
      // â˜… ì´ë¯¸ ë¡œë“œëœ ê²½ìš° ìŠ¤í‚µ
      if (detailDiv.dataset.loaded === 'true') {
        console.log(`âœ… ì±•í„° ${chapterId} ì´ë¯¸ ë¡œë“œë¨, UIë§Œ ì—…ë°ì´íŠ¸`);
        if (!detailDiv.classList.contains('active')) {
          detailDiv.classList.add('active');
          card.classList.add('expanded');
        }
        return;
      }
      
      // â˜… ë¡œë”© ì¤‘ì¸ ê²½ìš° ìŠ¤í‚µ
      if (detailDiv.dataset.loading === 'true') {
        console.log(`âš ï¸ ì±•í„° ${chapterId} ë¡œë”© ì¤‘, ìŠ¤í‚µ`);
        return;
      }
      
      const chapter = currentChapters[chapterId];
      if (!chapter) {
        console.log(`âš ï¸ ì±•í„° ${chapterId} ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ`);
        return;
      }
      
      // segmentsê°€ ì—†ìœ¼ë©´ ê²½ê³ 
      if (!currentSegments || currentSegments.length === 0) {
        console.warn('âš ï¸ ìë§‰ ì •ë³´ê°€ ì—†ì–´ ìƒì„¸ ì„¤ëª…ì„ ìƒì„±í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        return;
      }
      
      // â˜… ë¡œë”© í”Œë˜ê·¸ ì„¤ì •
      detailDiv.dataset.loading = 'true';
      
      // ë¡œë”© í‘œì‹œ ì—…ë°ì´íŠ¸ ("ëŒ€ê¸° ì¤‘..." â†’ "ì„¤ëª… ìƒì„± ì¤‘...")
      detailDiv.classList.add('active', 'loading');
      card.classList.add('expanded');
      detailDiv.innerHTML = '<div class="spinner"></div><p>ì„¤ëª… ìƒì„± ì¤‘...</p>';
      console.log(`ğŸ”„ ë¡œë”© ìƒíƒœ ì—…ë°ì´íŠ¸: ì±•í„° ${chapterId} (ì„¤ëª… ìƒì„± ì¤‘)`);
      
      try {
        console.log(`ğŸ“˜ ì±•í„° ${chapterId + 1} ì„¤ëª… ë¡œë“œ ì‹œì‘`);
        
        const response = await fetch('/api/explain', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            segments: currentSegments,
            start: chapter.start,
            end: chapter.end,
            lang: currentDetectedLang
          })
        });
        
        if (!response.ok) {
          const errorData = await response.json();
          throw new Error(errorData.error || 'ì„¤ëª… ìƒì„± ì‹¤íŒ¨');
        }
        
        const data = await response.json();
        
        // ì„¤ëª… í‘œì‹œ
        detailDiv.classList.remove('loading');
        detailDiv.innerHTML = `<p>${data.explanation}</p>`;
        detailDiv.dataset.loaded = 'true';
        
        console.log('âœ… ì±•í„° ì„¤ëª… ë¡œë“œ ì™„ë£Œ');
        
      } catch (error) {
        console.error('âŒ ì„¤ëª… ë¡œë“œ ì‹¤íŒ¨:', error);
        detailDiv.classList.remove('loading');
        detailDiv.innerHTML = '<p style="color:#ff7a59;">ì„¤ëª…ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>';
      } finally {
        // â˜… ë¡œë”© í”Œë˜ê·¸ í•´ì œ
        detailDiv.dataset.loading = 'false';
      }
    }
    
    /* ===== ì´ˆê¸°í™” ===== */
    console.log('âœ… ìŠ¤í¬ë¦½íŠ¸ ì´ˆê¸°í™” ì™„ë£Œ');
    loadVideoList();
  </script>
  
  <!-- Scripts for header functionality -->
  <script src="/js/jquery.min.js"></script>
  <script src="/js/jquery.scrollex.min.js"></script>
  <script src="/js/jquery.scrolly.min.js"></script>
  <script src="/js/browser.min.js"></script>
  <script src="/js/breakpoints.min.js"></script>
  <script src="/js/util.js"></script>
  <script src="/js/main.js"></script>
  <script src="/js/signup.js"></script>
  <script src="/js/login.js"></script>
  
  <!-- Custom JavaScript for popups and menu -->
  <script>
    function toggleLoginPopup() {
      const login = document.getElementById("login-popup");
      const signup = document.getElementById("signup-popup");
      if (signup && !signup.classList.contains("hidden")) {
        signup.classList.add("hidden");
      }
      if (login) {
        login.classList.toggle("hidden");
      }
    }

    function toggleSignupPopup() {
      const login = document.getElementById("login-popup");
      const signup = document.getElementById("signup-popup");
      if (login && !login.classList.contains("hidden")) {
        login.classList.add("hidden");
      }
      if (signup) {
        signup.classList.toggle("hidden");
      }
    }

    document.addEventListener('DOMContentLoaded', function() {
      if (typeof $ !== 'undefined') {
        const $menu = $('#menu');
        if ($menu.length > 0) {
          if ($menu.find('.close').length === 0) {
            $menu.append('<a href="#menu" class="close"></a>');
          }
          
          $menu.panel({
            delay: 500,
            hideOnClick: true,
            hideOnSwipe: true,
            resetScroll: true,
            resetForms: true,
            side: 'right',
            target: $('body'),
            visibleClass: 'is-menu-visible'
          });
        }
      }

      document.addEventListener('click', function(e) {
        const loginPopup = document.getElementById("login-popup");
        const signupPopup = document.getElementById("signup-popup");
        
        if (e.target.classList.contains('login-popup-wrapper') || 
          (e.target.classList.contains('popup') && e.target === e.currentTarget)) {
          if (loginPopup && !loginPopup.classList.contains('hidden')) {
            loginPopup.classList.add('hidden');
          }
          if (signupPopup && !signupPopup.classList.contains('hidden')) {
            signupPopup.classList.add('hidden');
          }
        }
      });
    });
  </script>
</body>
</html>
