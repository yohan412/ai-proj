<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">

<!--
  VidAnalyzer.html

  This HTML file serves as the main interface for the Cognitive Load Viewer application.
  It allows users to upload video files for analysis and displays the results,
  including a keyword network graph (powered by D3.js) and cognitive load graphs (powered by Chart.js).
  It integrates with Spring Boot for backend data and uses Thymeleaf for server-side rendering
  of dynamic content and inclusion of common fragments like the sidebar, topbar, and login modal.
-->

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Cognitive Load Viewer</title>
  
  <!--icon-->
  <link rel="icon" href="/images/profile/favicon.png" type="image/x-icon">

  <!-- Shared styles -->
  <link rel="stylesheet" href="/css/topbar.css">
  <link rel="stylesheet" href="/css/sidebar.css">
  <link rel="stylesheet" href="/css/loginModal.css">
  <link rel="stylesheet" href="/css/vid-analyzer.css">
  <link rel="stylesheet" href="/css/custom-video-player-component.css">

  <!-- Libraries -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://d3js.org/d3.v7.min.js"></script>

  <!-- Shared Scripts (Order is important) -->
    <script src="/js/session.js"></script>
    <script src="/js/auth-fetch.js"></script>
    <script src="/js/sidebar.js"></script>
    <script src="/js/topbar.js"></script>
    <script src="/js/loginModal.js"></script>
    <script src="/js/AnalyzerShare.js"></script>
    <script src="/js/VidAnalyzer.js"></script>

  <!-- Client-side auth guard -->
  <script>
    if (!isLoggedIn()) {
      window.location.href = '/';
    }
  </script>
</head>

<body>
  <!-- Left Sidebar fragment: navigation menu -->
  <!--
    This fragment includes the common sidebar navigation menu, allowing users to
    navigate to different sections of the application. The `toggleSidebar()` function
    is called to control its visibility.
  -->
  <div th:replace="~{fragments/sidebar :: sidebar}"></div>


  <!-- Sidebar toggle button (hamburger icon) -->
  <!--
    This button provides a way to toggle the visibility of the left sidebar on smaller screens.
  -->
  <div class="sidebar-toggle" onclick="toggleSidebar()">☰</div>


  <!-- Topbar fragment: login/profile/logout UI -->
  <!--
    This fragment includes the common top bar, which typically contains login,
    user profile, and logout functionalities.
  -->
  <div th:replace="~{fragments/topbar :: topbar}"></div>


  <!-- Login Modal fragment: login form dialog -->
  <!--
    This fragment includes the common login modal, which appears as a pop-up
    dialog for user authentication.
  -->
  <div th:replace="~{fragments/loginModal :: loginModal}"></div>


  <!-- Main Content: video analysis and graph area -->
  <!--
    This is the main container for the page's content, organized into sections
    for video upload and analysis results (graphs).
  -->
  <div class="container" id="mainContainer">

    <!-- Video Section: drag & drop/upload video -->
    <!--
      This section provides an area for users to drag and drop video files
      or click to select them for upload. It also includes a video player to
      preview the uploaded video.
    -->
	
    <div class="video-section" id="videoDrop">
      <p>Drag & Drop your video here or click to select</p>
      <input type="file" id="videoInput" accept="video/*" style="display: none" />
      <div th:replace="~{fragments/customVideoPlayer :: videoPlayer(playerId='videoPlayer')}"></div>
    </div>
	

    <!-- Graph Area: keyword network, cognitive load graph, HP bar -->
    <!--
      This section displays the analysis results, including the keyword network graph,
      cognitive load graphs (instantaneous and cumulative), and a horizontal HP bar
      (if implemented).
    -->
    <div class="graph-section" id="graphSection">

      <!-- Top: Keyword Network -->
      <div>
        <h3 class="graph-caption">Keyword Network</h3>
        <div class="graph-container">
          <div class="graph-loading-overlay">
            <div class="spinner"></div>
          </div>
          <div class="graph-wrapper"> <!-- Wrapper for graph and button -->
              <div class="zettel-graph" id="zettelGraph"></div>
              <button class="expand-btn" id="expandZettelGraph" title="Expand Graph">⛶</button>
          </div>
        </div>
      </div>


      <!-- Bottom: Cognitive Load Graph + HP Bar -->
      <div>
        <h3 class="graph-caption">Cognitive Load & Fatigue</h3>
        <div class="cognitive-load-controls">
          <button id="showCumulativeBtn">Show Cumulative</button>
          <button id="showInstantaneousBtn">Show Instantaneous</button>
        </div>
        <div class="graph-container">
          <div class="graph-loading-overlay">
            <div class="spinner"></div>
          </div>
          <div class="graph-wrapper">
            <div class="dual-graph">
              <canvas id="dualGraphCanvas"></canvas>
            </div>
            <button class="expand-btn" id="expandCognitiveLoadGraph" title="Expand Graph">⛶</button>
          </div>
          <!-- Horizontal HP Bar -->
          <!--
          This element represents a horizontal "HP" (Health Point) bar, which
          could be used to visually represent fatigue or cognitive load levels over time.
        -->
          <div class="hp-bar hp-horizontal">
            <div class="hp-bar-fill" id="hpFill"></div>
          </div>
        </div>
      </div>
    </div>
  </div>


  <!-- Modal for Zettel Graph -->
  <div id="zettelGraphModal" class="modal-overlay">
    <div class="modal-content">
      <span class="modal-close" id="closeZettelGraphModal">&times;</span>
      <div class="graph-modal-content">
          <div id="zettelGraphModalContent" class="zettel-graph-wrapper"></div>
      </div>
    </div>
  </div>

  <!-- Modal for Cognitive Load Graph -->
  <div id="cognitiveLoadModal" class="modal-overlay">
    <div class="modal-content">
      <span class="modal-close" id="closeCognitiveLoadModal">&times;</span>
      <div class="graph-modal-content">
          <canvas id="cognitiveLoadModalCanvas"></canvas>
      </div>
    </div>
  </div>


  <!-- Scripts -->
  <!--
    These script tags are included at the end of the body for performance reasons,
    ensuring that the HTML content is parsed and rendered before the scripts are executed.
  -->
  <!--
    The following comment indicates that some inlined JavaScript logic was previously present
    but has been moved to external files for better maintainability and safety.
  -->
  <!-- Inlined app.js: Only used logic for this page (Spring/Thymeleaf ready, no demo data) -->
  <!-- All inlined <script> blocks have been verified to be contained in external JS files. Remove them for safety and maintainability. -->
</body>

</html>